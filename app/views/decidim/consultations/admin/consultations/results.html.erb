<div class="card" id="consultations">
  <div class="card-divider">
    <h2 class="card-title">
      <%= t "decidim.admin.titles.results" %>
      <span class="label button--title">
        <%= t "decidim.admin.consultations.results.total_votes", count: current_consultation.total_votes %>
        /
        <%= t "decidim.admin.consultations.results.participants", count: current_consultation.total_participants %>
        </span>
    </h2>
  </div>
  <div class="card-section">

      <% current_consultation.questions.published.includes(:responses).each do |question| %>
        <% unless question.external_voting %>
          <table class="table-list consultation-results">
            <thead>
              <tr>
                <th class="question-title"><%= strip_tags translated_attribute question.title %></th>
                <th class="table-list__actions">
                  <%= t "decidim.admin.consultations.results.total_votes", count: question.total_votes %>
                  /
                  <%= t "decidim.admin.consultations.results.participants", count: question.total_participants %>
                </th>
              </tr>
            </thead>
            <tbody>
              <% if question.publishable_results? %>
                <% if question.grouped? %>
                  <% question.grouped_responses.each do |group, responses| %>
                    <tr class="question-subtitle">
                      <th><%= translated_attribute group.title %></th>
                      <th>Votos</th>
                    </tr>
                    <% responses.sort_by{|r| -r[:votes_count]}.each do |response| %>
                      <tr>
                        <td class="response-title--grouped"><%= strip_tags translated_attribute response.title %></td>
                        <td><%= response.votes_count %></td>
                      </tr>
                    <% end %>
                  <% end %>
                <% else %>
                  <% question.sorted_results.sort_by{|r| -r[:votes_count]}.each do |response| %>
                  <tr>
                    <td class="response-title"><%= strip_tags translated_attribute response.title %></td>
                    <td><%= response.votes_count %></td>
                  </tr>
                  <% end %>
                <% end %>
              <% else %>
                <tr><td><em><%= t "decidim.admin.consultations.results.not_visible" %></em></td><td>&nbsp;</td></tr>
              <% end %>
            </tbody>
          </table>
        <% end %>
      <% end %>
  </div>
</div>

<%= stylesheet_link_tag "results-tables" %>
